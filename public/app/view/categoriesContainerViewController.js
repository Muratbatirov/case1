/*
 * File: app/view/categoriesContainerViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.9.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 7.3.x Modern library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 7.3.x Modern. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Case.view.categoriesContainerViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.categoriescontainer',

    editCategory: function() {

        this.redirectTo('categories/edit');


    },

    oneditstore: function(thiss, records, successful, operation, eOpts) {
        var me= this;




               // var categoryrecord= me.down('editcategorytree').getViewModel().get('crecordtree').data.id;
              //  console.log(categoryrecord);
               var arr =[];

               arr=records;
        //console.log(arr);





        //recurse(arr,categoryrecord );
        var arrnew=[{"id":0,"parent_id":null,"category":"Нет","parentcategory":"null","level":0}];
         arr.forEach(function(item, i, arr) {
            arrnew.push(item.data);

         });
        thiss.setData(arrnew);
    },

    onDobavitCategory: function(button, e, eOpts) {
        var me= this;


        let dialog=Ext.create({
        xtype: 'dialogaddcategory'});

        var categoryrecord=  this.getViewModel().get('crecordtree');
        console.log(categoryrecord);

        let editcombostore= Case.app.getStore('categoryEditCombo');

        editcombostore.addListener({
            load: me.oneditstore,
            scope:me

        });






        let ell = document.getElementsByClassName("x-navigationview");

        let widthcalculate = ell[0].offsetWidth;
        let heightcalculate = ell[0].offsetHeight;
        dialog.setConfig('width',widthcalculate);

        dialog.setConfig('height',heightcalculate);
        dialog.setConfig('buttons',{
            ok: function () {


                dialog.destroy();

            }
        });



        dialog.down('formpanel').setViewModel({data:{crecordtree:categoryrecord}});

        dialog.show();
    }

});